---
name: dev-task
description: "该技能用于指导“复杂需求的开发流程”，强调抽象步骤与可复用的落地方式，而不是针对某个具体需求的复盘总结。它帮助在多轮对话中澄清目标、在执行阶段组织任务与队列、在收尾阶段补齐测试与边界处理。"
---

## 重要
- 永远使用中文进行对话

## 抽象流程

### 1) 需求澄清与方案对齐
在多轮对话与代码阅读中，由 agent **自行补全问题清单**，默认不采用问答模式。
默认将“用户输入的第一段内容”视为需求描述与初步方案的来源，agent 应据此生成并细化方案内容。

**问题清单（agent 内部补全）**
- 目标/范围是什么？是否只改某一模块？
- 性能/一致性要求是什么？能接受哪些改动？
- 是否需要保留既有行为/接口/事件形态？
- 是否有必须覆盖的边界或风险点？
- 需要哪些测试（单测/集成/回归）？

**仅在信息不足时才改为问答模式**
- 示例起始提问：“要实现的功能或者解决的问题是什么？”

### 2) 任务确认（创建后需用户确认）
- agent 生成任务文件并加入队列后，必须请用户确认任务内容。
- 用户确认后才进入执行；用户可在此阶段补充或修改任务描述。

### 2.1) 执行前评估（可选红队测试）
若满足以下任一条件，应询问用户是否加入“红队测试”以挑战方案：
- 核心链路
- 性能优先
- 功能复杂

红队测试用于让 agent 以“同侪审视”的方式挑战已生成方案（假设、边界、并发、回滚、降级等），从而提前暴露风险。

**红队固定检查项**
- 本地环境差异（Node 版本/engine warning/权限限制）是否会影响执行与验收

### 3) 执行落地（实现阶段）
- 设计职责边界：例如入口分发、队列管理、聚合策略、广播方式各司其职。
- 保持主流程简洁、可插拔；避免把复杂逻辑塞进单一函数。
- 若涉及性能热点，可以在执行前，先提请用户确认是否需要优化，探讨优化方案。
- 将对话中给出的**方案说明** **方案细节** **约束条件** **注意事项** 等写入任务描述的 `Notes`（补充/变更记录）中，避免执行时二次丢失上下文。
- 如涉及**破坏性修改**（接口变更、行为改变、数据格式变化），必须在任务中明确标注，并在执行前提醒用户。

### 3.5) 短路模式（仅分析/建议）
当用户明确要求“只分析/建议、不执行”时：
- 不创建任务、不写队列，仅给出建议与风险提示。

### 4) 细节补全与质量保障
- 补充边界处理（空数据、形态保持、切换/迁移不丢）。
- 添加单测覆盖任务以及当前方案中的关键路径、边界条件。
- 在验证阶段记录命令结果与已知阻塞。
- 若相关模块已有单测，必须补充**修改范围**的单测，覆盖“正常功能 + 边界情况”。

## 任务目录与引用指示

当需要正式执行“任务”时，必须遵循技能内的任务工作流与模板引用：
- 你需要读取当前 `SKILL.md` 所在目录下的 `references` 目录下的文件，不得声称其不存在。
- `references/task-workflow.md`：任务流程与权限约束（默认只读；经用户授权可修改）
- `references/000-task-example.md`：任务模板示例（默认只读；经用户授权可修改）
- 若 `references/000-task-example.md` 存在，必须优先参考该模板，不得声称其不存在。
- 仓库内仅保留可审计文件：
  - `tasks/queue.md`
  - `tasks/items/{id}.md`
  - `tasks/workers/worker-*.md`

如果项目根目录不存在 `tasks/` 结构，应创建以下目录与文件：
- `tasks/queue.md`
- `tasks/items/`
- `tasks/workers/`

并确保后续任务执行严格按照 `references/task-workflow.md` 约束更新。


### 用户触发指令（任务执行）
- 用户输入 **“创建”** 表示：由 agent 创建任务文件。
- 创建完成后需用户确认任务内容，再开始加入队列并执行。
- 如未指定 worker，由 agent 选择空闲 worker 并在对话中确认。

### 任务完成与增量补充约定
- **代码清理阶段（可选）**
  - 在任务完工阶段执行；应先询问用户是否需要执行 `代码清理` 流程。
  - 具体流程见 `references/code-simplifier.md`。
- 任务完成时，agent 必须明确说明：已完成任务 + 已验收（或给出验收结果），并提示即将退出当前任务上下文。
- 退出任务上下文前，必须获得用户的明确确认；未确认则保持在当前任务上下文。
- 同时告知用户：如需补充调整，请使用关键词触发（见下）。
- 以下关键词均视为“当前任务的增量需求”，不得新建任务：**补充 / 调整 / 追加**。
- 触发后，先进入多轮对话讨论补充方案，不要立即追加到任务文档。
- 方案讨论后，agent 需询问用户是否确认补充调整；仅在用户确认后，才将内容追加到当前任务的补充条目或变更记录中，并以增量方式继续执行与补测。

## 验收标准（通用指引）

### 默认验收模板（可复用）
- 不引入新的 TypeScript / ESLint error
- 功能行为与需求一致（包含正常与边界场景）
- 既有 API/对外行为不被破坏（除非明确允许）
- 关键路径具备测试覆盖

### 默认测试模板（通用）
- 核心功能测试：覆盖主流程的正常输入与输出
- 边界场景测试：空输入、异常输入、重复/并发输入
- 时序行为测试：延迟触发、批量触发、重入场景
- 路由/范围测试：作用范围变化时行为正确（如订阅/权限/过滤切换）
